scripts:
  build:
    default: nps build.prepare build.config build.markup build.style build.assets build.zenplayer
    prepare: mkdirp 'build'
    config:
      default: nps build.config.robots build.config.htaccess
      robots: cp -R 'web/main/robots/' 'build'
      htaccess: cat 'web/main/.htaccess' 'node_modules/apache-server-configs/dist/.htaccess' >'build/.htaccess'
    markup:
      default: nps build.markup.index build.markup.error
      index: mustache -p 'web/main/markup/head.html.mustache' 'web/main/data/index.json' 'web/main/markup/index.html.mustache' >'build/index.html'
      error: mustache -p 'web/main/markup/head.html.mustache' 'web/main/data/error.json' 'web/main/markup/error.html.mustache' >'build/error.html'
    style:
      default: nps build.style.scss build.style.prefix
      scss: node-sass 'web/main/style' --include-path 'node_modules' --linefeed lf --output-style expanded --output 'build/css'
      prefix: postcss 'build/css' --use autoprefixer --no-map --replace
    assets:
      default: nps build.assets.images build.assets.favicon
      images: cp -R 'web/main/images/' 'build/images'
      favicon: cp -R 'web/main/favicon/' 'build'

    # zenplayer subpage is planned to be moved elsewhere
    # so we move it aside to be ready to be removed
    zenplayer:
      default: nps build.zenplayer.prepare build.zenplayer.markup
      prepare: mkdirp 'build/zenplayer'
      markup: mustache -p 'web/main/markup/head.html.mustache' 'web/zenplayer/index.json' 'web/zenplayer/index.html.mustache' >'build/zenplayer/index.html'

  clean:
    default: rimraf 'build' 'dist'
