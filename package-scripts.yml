scripts:
  build:
    default: nps build.prepare && concurrently 'nps build.config' 'nps build.code' 'nps build.assets'
    prepare: mkdirp 'build' 'build/zenplayer'
    config:
      default: concurrently 'nps build.config.robots' 'nps build.config.htaccess'
      robots: cp -R 'web/robots/' 'build'
      htaccess: cat 'web/.htaccess' 'node_modules/apache-server-configs/dist/.htaccess' >'build/.htaccess'
    code:
      default: concurrently 'nps build.code.markup' 'nps build.code.style'
      markup:
        default: concurrently 'nps build.code.markup.index' 'nps build.code.markup.error' 'nps build.code.markup.zenplayer'
        index: mustache -p 'web/markup/head.html.mustache' 'web/data/index.json' 'web/markup/index.html.mustache' >'build/index.html'
        error: mustache -p 'web/markup/head.html.mustache' 'web/data/404.json' 'web/markup/404.html.mustache' >'build/404.html'
        zenplayer: mustache -p 'web/markup/head.html.mustache' 'web/data/zenplayer.json' 'web/markup/zenplayer.html.mustache' >'build/zenplayer/index.html'
      style:
        default: nps build.code.style.scss build.code.style.prefix
        scss: node-sass 'web/style' --include-path 'node_modules' --linefeed lf --output-style expanded --output 'build/css'
        prefix: postcss 'build/css' --use autoprefixer --no-map --replace
    assets:
      default: concurrently 'nps build.assets.images' 'nps build.assets.favicon'
      images: cp -R 'web/images/' 'build/images'
      favicon: cp -R 'web/favicon/' 'build'

  watch:
    default: nps build.prepare && concurrently 'nps watch.config' 'nps watch.code' 'nps watch.assets'
    config:
      default: concurrently 'nps watch.config.robots' 'nps watch.config.htaccess'
      robots: onchange 'web/robots/*' -- nps build.config.robots
      htaccess: onchange 'web/.htaccess' -- nps build.config.htaccess
    code:
      default: concurrently 'nps watch.code.markup' 'nps watch.code.style'
      markup: onchange 'web/markup/*' 'web/data/*' -- nps build.code.markup
      style: onchange 'web/style/*' -- nps build.code.style
    assets:
      default: concurrently 'nps watch.assets.images' 'nps watch.assets.favicon'
      images: onchange 'web/images/*' -- nps build.assets.images
      favicon: onchange 'web/favicon/*' -- nps build.assets.favicon
